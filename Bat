@echo off
chcp 65001 >nul
setlocal EnableDelayedExpansion

:: Handle update command
if /i "%1"=="update" (
    set "GITHUB_URL=https://raw.githubusercontent.com/ovsepantamerlan36/BatCFG/main/Bat"
    set "SELF=%~f0"
    curl -s -o "%SELF%" "%GITHUB_URL%"
    if !errorlevel! neq 0 (
        echo Error updating configuration.
        pause
        exit /b 1
    )
    echo Configuration updated successfully.
    pause
    exit /b 0
)

:: Search for SteamLibrary
for %%D in (C D E F G H I J K L M N O P Q R S T U V W X Y Z) do (
    if exist "%%D:\SteamLibrary\steamapps\common\Counter-Strike Global Offensive\game\bin\win64\" (
        set "TARGET_DIR=%%D:\SteamLibrary\steamapps\common\Counter-Strike Global Offensive\game\bin\win64"
        goto :found
    )
)
echo SteamLibrary folder not found.
pause
exit /b 1

:found
:: Verify TARGET_DIR is set
if not defined TARGET_DIR (
    echo TARGET_DIR is not defined.
    pause
    exit /b 1
)

:: Prompt for slot number
set /p SLOT="Select a free config slot: "
:: Validate SLOT is a number
echo %SLOT%| findstr /r "^[0-9]*$" >nul
if %ERRORLEVEL% neq 0 (
    echo Error: Please enter a number.
    pause
    exit /b 1
)

set "FILE=pslot%SLOT%"
if not exist "!TARGET_DIR!\!FILE!" (
    curl -s https://raw.githubusercontent.com/ovsepantamerlan36/BatCFG/main/Pslot1 > "!TARGET_DIR!\!FILE!"
    if !errorlevel! neq 0 (
        echo Error creating file !FILE!.
        pause
        exit /b 1
    )
)
echo Configuration for slot %SLOT% processed successfully.
pause
exit /b 0
